# MetamorphUI - Cursor Rules

## ğŸ¯ But de l'application

MetamorphUI est un SaaS qui transforme automatiquement les designs Figma (ouPenpot) en code Token et composants React (ou Vue) prÃªt pour la production.

### FonctionnalitÃ©s principales

- **Import depuis Figma** : Connexion Ã  des fichiers Figma via l'API Figma
- **GÃ©nÃ©ration de tokens de design** : Extraction automatique des variables Figma (couleurs, typographie, espacements) et export en CSS custom properties
- **GÃ©nÃ©ration de composants React** : Transformation des composants Figma en composants React rÃ©utilisables et prÃªts pour la production
- **Synchronisation** : Mise Ã  jour automatique des tokens et composants quand les designs Figma changent

### Public cible

DÃ©veloppeurs et Ã©quipes design/dev qui veulent automatiser le passage du design (Figma) au code (React).

## ğŸ—ï¸ Architecture technique

### Stack

- **Framework** : Next.js 14 (App Router)
- **Language** : TypeScript
- **Base de donnÃ©es** : PostgreSQL avec Prisma ORM
- **Authentification** : NextAuth.js (Credentials, Google OAuth, GitHub OAuth)
- **Email** : Resend pour l'envoi d'emails de vÃ©rification
- **Styling** : Tailwind CSS + shadcn/ui
- **ThÃ¨me** : next-themes pour le mode clair/sombre

### Structure du projet

```
app/
  â”œâ”€â”€ api/              # Routes API (NextAuth, signup, verification, etc.)
  â”œâ”€â”€ dashboard/        # Dashboard utilisateur
  â”œâ”€â”€ signin/           # Page de connexion
  â”œâ”€â”€ signup/           # Page d'inscription
  â”œâ”€â”€ verify-email/     # VÃ©rification d'email
  â””â”€â”€ resend-verification/ # Renvoi d'email de vÃ©rification

components/
  â”œâ”€â”€ auth/             # Composants d'authentification
  â”œâ”€â”€ ui/               # Composants shadcn/ui
  â”œâ”€â”€ theme-provider.tsx # Provider pour next-themes
  â””â”€â”€ theme-toggle.tsx   # SÃ©lecteur de thÃ¨me

lib/
  â”œâ”€â”€ auth.ts           # Configuration NextAuth
  â”œâ”€â”€ prisma.ts         # Client Prisma
  â”œâ”€â”€ email.ts          # Service d'envoi d'emails (Resend)
  â””â”€â”€ session.ts        # Utilitaires de session

prisma/
  â””â”€â”€ schema.prisma     # SchÃ©ma de base de donnÃ©es
```

## ğŸ“Š ModÃ¨le de donnÃ©es

### User

- Informations utilisateur (email, nom, mot de passe hashÃ©)
- `emailVerified` : Date de vÃ©rification de l'email (null si non vÃ©rifiÃ©)
- Relations : accounts (OAuth), sessions, projects

### Project

- Projet liÃ© Ã  un fichier Figma
- Contient `figmaFileId` et `figmaApiKey` (chiffrÃ©e)
- Relation : user, tokens

### Token

- Tokens de design extraits de Figma
- Types : color, typography, spacing, etc.
- Contient `figmaVariableId` si disponible
- Relation : project

### Account

- Comptes OAuth (Google, GitHub)
- GÃ©rÃ© par NextAuth avec PrismaAdapter

### VerificationToken

- Tokens pour la vÃ©rification d'email
- Expire aprÃ¨s 24 heures

## ğŸ” Authentification

### Flux d'inscription

1. Utilisateur s'inscrit avec email/password
2. Compte crÃ©Ã© avec `emailVerified: null`
3. Token de vÃ©rification gÃ©nÃ©rÃ© et stockÃ©
4. Email de vÃ©rification envoyÃ© via Resend
5. Utilisateur clique sur le lien â†’ email vÃ©rifiÃ©
6. Utilisateur peut se connecter

### OAuth (Google/GitHub)

- Les utilisateurs OAuth n'ont pas besoin de vÃ©rifier leur email (dÃ©jÃ  vÃ©rifiÃ© par le provider)
- `emailVerified` est automatiquement rempli par NextAuth
- Support de la liaison de comptes avec `allowDangerousEmailAccountLinking: true`

### SÃ©curitÃ©

- Les utilisateurs non vÃ©rifiÃ©s ne peuvent pas se connecter
- Les tokens de vÃ©rification expirent aprÃ¨s 24h
- PossibilitÃ© de renvoyer un email de vÃ©rification via `/resend-verification`

## ğŸ“§ Email

### Configuration

- Service : Resend
- Domaine vÃ©rifiÃ© : `davidduprat.fr` (temporaire, en attente de `metamorphui.com`)
- From : `noreply@davidduprat.fr`

### Emails envoyÃ©s

- Email de vÃ©rification lors de l'inscription
- Email de renvoi de vÃ©rification si le lien a expirÃ©

## ğŸ¨ UI/UX

### ThÃ¨me

- Support du mode clair/sombre avec `next-themes`
- DÃ©tection automatique de la prÃ©fÃ©rence systÃ¨me
- SÃ©lecteur de thÃ¨me dans le header

### Composants

- Utilisation de shadcn/ui pour les composants de base
- Tailwind CSS pour le styling
- Design responsive

## ğŸ”„ Conventions de code

### Naming

- Composants : PascalCase (`SignUpForm.tsx`)
- Fichiers : kebab-case pour les routes, PascalCase pour les composants
- Variables : camelCase
- Types/Interfaces : PascalCase

### Imports

- Imports absolus avec `@/` (configurÃ© dans `tsconfig.json`)
- Ordre : React â†’ Next.js â†’ librairies externes â†’ composants locaux â†’ styles

### API Routes

- Routes dans `app/api/`
- Utilisation de `NextResponse` pour les rÃ©ponses
- Gestion d'erreurs avec try/catch et codes HTTP appropriÃ©s

### Base de donnÃ©es

- Utilisation de Prisma pour toutes les requÃªtes
- Transactions pour les opÃ©rations multiples
- Validation des donnÃ©es avant insertion

## ğŸš€ DÃ©ploiement

### Variables d'environnement requises

```env
# Base de donnÃ©es
DATABASE_URL="postgresql://..."

# NextAuth
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="..."

# OAuth (optionnel)
GOOGLE_CLIENT_ID="..."
GOOGLE_CLIENT_SECRET="..."
GITHUB_CLIENT_ID="..."
GITHUB_CLIENT_SECRET="..."

# Email (Resend)
RESEND_API_KEY="..."
RESEND_FROM_EMAIL="noreply@davidduprat.fr"

# Encryption (pour les API keys Figma)
ENCRYPTION_KEY="..."
```

## ğŸ“ Notes importantes

### Ã€ faire

- [ ] Internationalisation (FR/EN) - en attente
- [ ] IntÃ©gration API Figma
- [ ] GÃ©nÃ©ration de tokens depuis Figma
- [ ] GÃ©nÃ©ration de composants React depuis Figma
- [ ] Dashboard pour gÃ©rer les projets
- [ ] Export de tokens en CSS/JSON

### Domaines

- Domaine temporaire : `davidduprat.fr`
- Domaine prÃ©vu : `metamorphui.com` (en attente de crÃ©ation chez Scaleway)

### SÃ©curitÃ©

- Les API keys Figma doivent Ãªtre chiffrÃ©es avant stockage
- Validation stricte des entrÃ©es utilisateur
- Protection CSRF avec NextAuth
- Rate limiting Ã  implÃ©menter pour les routes API

## ğŸ› Debugging

### Logs

- Les logs OAuth sont activÃ©s en mode dÃ©veloppement
- Logs dÃ©taillÃ©s pour l'envoi d'emails
- Console.log pour le debugging (Ã  remplacer par un vrai logger en production)

### Erreurs communes

- Erreur "Email not verified" : L'utilisateur doit vÃ©rifier son email
- Erreur "OAuthAccountNotLinked" : Compte OAuth non liÃ© Ã  un compte existant
- Erreur Resend 403 : Domaine non vÃ©rifiÃ© ou email non autorisÃ© (mode test)
